<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Читалка</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #111;
    color: white;
    height: 100%;
    overflow: hidden;
    user-select: none;
}

#viewer {
    overflow-y: scroll;
    height: 100vh;
}

canvas {
    display: block;
    margin: 10px auto;
    max-width: 100%;
}
</style>
</head>

<body>
<div id="viewer"></div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// ❌ если открыли НЕ из Telegram — не пускаем
if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
    document.body.innerHTML = "<h2>Открывайте через Telegram</h2>";
    throw new Error("Not Telegram");
}

pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

const url = "book.pdf"; // имя PDF

const viewer = document.getElementById("viewer");

pdfjsLib.getDocument(url).promise.then(pdf => {
    for (let i = 1; i <= pdf.numPages; i++) {
        pdf.getPage(i).then(page => {
            const viewport = page.getViewport({ scale: 1.5 });
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");

            canvas.width = viewport.width;
            canvas.height = viewport.height;

            viewer.appendChild(canvas);

            page.render({
                canvasContext: ctx,
                viewport: viewport
            });
        });
    }
});
</script>
</body>
</html>
