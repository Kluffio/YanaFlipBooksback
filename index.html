<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ß–∏—Ç–∞–ª–∫–∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
* { box-sizing:border-box; }

body {
  margin:0;
  background:#111;
  color:#fff;
  font-family:system-ui,sans-serif;
  overflow:hidden;
}

/* ===== SCREENS ===== */
.screen {
  position:fixed;
  inset:0;
  display:none;
  flex-direction:column;
}
.screen.active { display:flex; }

/* ===== HEADER ===== */
header {
  height:56px;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 12px;
}

header button {
  margin-left:6px;
  padding:8px 12px;
  border-radius:8px;
  border:none;
  background:#fff;
}

/* ===== CONTENT ===== */
.content {
  flex:1;
  overflow-y:auto;
  padding:20px 0;
}

/* ===== LOGIN ===== */
#loginScreen {
  justify-content:center;
  align-items:center;
}

.loginBox {
  background:#1c1c1c;
  padding:28px;
  border-radius:16px;
  width:100%;
  max-width:360px;
}

.loginBox input,
.loginBox button {
  width:100%;
  padding:14px;
  margin-top:12px;
  font-size:16px;
  border-radius:10px;
  border:none;
}

/* focus / active */
.loginBox input:focus-visible {
  outline:2px solid #3a82f7;
}
.loginBox button {
  background:#3a82f7;
  color:#fff;
}
.loginBox button:active {
  transform:scale(0.98);
}

/* ===== PDF ===== */
#pdf {
  display:flex;
  flex-direction:column;
  align-items:center;
}

.spread {
  display:flex;
  gap:4px;
  margin-bottom:32px;
}

canvas {
  background:#fff;
  display:block;
}

/* ===== ZOOM ===== */
.zoom {
  position:fixed;
  right:16px;
  bottom:16px;
  z-index:9999;
}
.zoom button {
  width:44px;
  height:44px;
  font-size:22px;
  border:none;
  border-radius:10px;
  margin-top:6px;
}

/* ===== MOBILE ===== */
@media (max-width: 700px) {
  .spread {
    flex-direction:column;
    gap:0;
  }
}
</style>
</head>

<body>

<!-- LOGIN -->
<section id="loginScreen" class="screen active">
  <div class="loginBox">
    <h2 style="text-align:center">–í—Ö–æ–¥</h2>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
  </div>
</section>

<!-- READER -->
<section id="readerScreen" class="screen">
  <header>
    <div>üìñ –ß–∏—Ç–∞–ª–∫–∞</div>
    <div>
      <button onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>
  </header>
  <div class="content">
    <div id="pdf"></div>
  </div>
</section>

<div class="zoom" id="zoom" style="display:none">
  <button onclick="zoomIn()">+</button>
  <button onclick="zoomOut()">‚àí</button>
</div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
  apiKey: "AIzaSyBI_MW2hD1k5ORHZF_56zVzJvelHSVnvko",
  authDomain: "book-aed2c.firebaseapp.com",
  projectId: "book-aed2c"
});
const auth = firebase.auth();

/* ===== STATE ===== */
let pdfDoc = null;
let SCALE = window.innerWidth < 700 ? 1.1 : 1.6;
const isMobile = window.innerWidth < 700;

/* ===== LOGIN ===== */
function login() {
  auth.signInWithEmailAndPassword(email.value, password.value)
    .then(() => {
      loginScreen.classList.remove("active");
      readerScreen.classList.add("active");
      zoom.style.display = "block";
      loadPDF();
    })
    .catch(() => alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞"));
}

function logout() {
  auth.signOut();
  location.reload();
}

/* ===== PDF ===== */
function loadPDF() {
  pdfjsLib.getDocument("book.pdf").promise.then(pdf => {
    pdfDoc = pdf;
    renderAll();
  });
}

function renderAll() {
  pdf.innerHTML = "";

  if (isMobile) {
    // üì± –û–î–ù–ê –°–¢–†–ê–ù–ò–¶–ê
    for (let i = 1; i <= pdfDoc.numPages; i++) {
      renderPage(i, pdf);
    }
  } else {
    // üñ• –†–ê–ó–í–û–†–û–¢
    for (let i = 1; i <= pdfDoc.numPages; i += 2) {
      const spread = document.createElement("div");
      spread.className = "spread";
      renderPage(i, spread);
      if (i + 1 <= pdfDoc.numPages) renderPage(i + 1, spread);
      pdf.appendChild(spread);
    }
  }
}

function renderPage(num, container) {
  pdfDoc.getPage(num).then(page => {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    const dpr = window.devicePixelRatio || 1;
    const vp = page.getViewport({ scale: SCALE });

    canvas.width = vp.width * dpr;
    canvas.height = vp.height * dpr;
    canvas.style.width = vp.width + "px";
    canvas.style.height = vp.height + "px";

    ctx.setTransform(dpr,0,0,dpr,0,0);
    page.render({ canvasContext: ctx, viewport: vp });
    container.appendChild(canvas);
  });
}

/* ===== ZOOM ===== */
function zoomIn() { SCALE += 0.2; renderAll(); }
function zoomOut() { SCALE = Math.max(0.6, SCALE - 0.2); renderAll(); }
</script>

</body>
</html>
