<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Читалка</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #111;
    height: 100%;
    overflow: hidden;
    user-select: none;
}

#blocked {
    display: none;
    color: white;
    text-align: center;
    margin-top: 40vh;
    font-size: 18px;
    opacity: 0.8;
}

#viewer {
    height: 100vh;
    overflow-y: auto;
}

.row {
    display: flex;
    justify-content: center;
}

canvas {
    margin: 10px;
    max-width: 100%;
}
</style>
</head>

<body>

<div id="blocked">Нет доступа</div>
<div id="viewer"></div>

<script>
/* ====== СЕКРЕТНЫЙ КЛЮЧ ====== */
const SECRET_KEY = "hdsfkljgfhdfighikujdfsghiuoergfhieurfgigdfgdsg1123dcfs!";

/* ====== ПРОВЕРКА КЛЮЧА ====== */
const params = new URLSearchParams(window.location.search);
const key = params.get("key");

if (key !== SECRET_KEY) {
    document.getElementById("blocked").style.display = "block";
    throw new Error("Access denied");
}

// убираем ключ из адресной строки
history.replaceState({}, "", location.pathname);

/* ====== PDF.js ====== */
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

const PDF_FILE = "book.pdf";
const viewer = document.getElementById("viewer");
let pdfDoc = null;

function isLandscape() {
    return window.innerWidth > window.innerHeight;
}

function renderPDF() {
    viewer.innerHTML = "";
    let page = 1;
    const perRow = isLandscape() ? 2 : 1;

    function renderRow() {
        if (page > pdfDoc.numPages) return;

        const row = document.createElement("div");
        row.className = "row";

        for (let i = 0; i < perRow && page <= pdfDoc.numPages; i++) {
            const current = page++;

            pdfDoc.getPage(current).then(p => {
                const vp = p.getViewport({ scale: 1.4 });
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");

                canvas.width = vp.width;
                canvas.height = vp.height;

                row.appendChild(canvas);

                p.render({
                    canvasContext: ctx,
                    viewport: vp
                });
            });
        }

        viewer.appendChild(row);
        setTimeout(renderRow, 30);
    }

    renderRow();
}

pdfjsLib.getDocument(PDF_FILE).promise.then(pdf => {
    pdfDoc = pdf;
    renderPDF();
});

window.addEventListener("resize", renderPDF);
</script>

</body>
</html>
